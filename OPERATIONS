创建docker镜像
git clone https://github.com/jxph025319/webvirtmgr.git
cd webvirtmgr/build
或者
cp webvirtmgr/build_dev ~
注意更新目录文件
mv webvirtmgr ~/build_dev

docker build --no-cache -t whharbor.centos.org/centos/webvirtmgr:v1 .

webvirtmgr容器部署
groupadd -g 1010 libvirtd
useradd -u 1010 -g libvirtd -s /sbin/nologin -d /data/vm webvirtmgr
chown -R webvirtmgr:libvirtd /data/vm
# 默認賬號密碼為root/Cestc_01

开发部署命令
docker run -d --name webvirtmgr_dev -h webvirtmgr_dev -v /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime  --privileged=true -v /data/vm1:/data/vm -p 2100:22 -p 8080:8080 -p 6080:6080 -m 4g whharbor.cestc.cn/centos/webvirtmgr:v5.0.5 /usr/sbin/init
生产部署命令
docker run -d --name webvirtmgr -h webvirtmgr -v /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime  --privileged=true -v /data/vm:/data/vm -p 8080:8080 -p 6080:6080 -m 4g whharbor.cestc.cn/centos/webvirtmgr:v6.0.0


docker实例内信任部署：
chown -R webvirtmgr:libvirtd /data/vm
su - webvirtmgr -s /bin/bash
ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa
touch ~/.ssh/config && echo -e "StrictHostKeyChecking=no\nUserKnownHostsFile=/dev/null" >> ~/.ssh/config
chmod 0600 ~/.ssh/config

删除数据库文件和用户
rm -rf /data/vm
userdel webvirtmgr

針對客戶物理機的操作
su - webvirtmgr -s /bin/bash
ssh-copy-id root@172.16.87.64

宿主机创建信任
docker exec -it webvirtmgr_dev su - webvirtmgr -c "ssh-keygen -t rsa"
docker exec -it webvirtmgr_dev su - webvirtmgr -c "sshpass -p yHTq58js\&s9C\!ceV ssh-copy-id -o StrictHostKeyChecking=no root@10.101.232.254"

初始化admin 账号密码
echo "from rbac.models import UserInfo as User ; User.objects.create_superuser('admin', 'admin@localhost', 'Cestc_01')" | /usr/bin/python /opt/webvirtmgr/manage.py shell

国际化
python manage.py makemessages -l zh_Hans
vim /opt/webvirtmgr/locale/zh_Hans/LC_MESSAGES/django.po
python manage.py compilemessages --locale /opt/webvirtmgr/locale/zh_Hans

备份和还原数据库
python manage.py dumpdata rbac > init.json
python manage.py loaddata init.json